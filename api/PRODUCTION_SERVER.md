# üöÄ Production Server Setup

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### Development Server (index.py)
```python
app.run(debug=True, threaded=True)
```

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: `threaded=True` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è production (single process, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

**–ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:** ~5-10 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã)

---

## Production Deployment

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Waitress (Windows/Linux)**

Waitress - production-ready WSGI server –¥–ª—è Python, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
pip install waitress
```

#### –ó–∞–ø—É—Å–∫:
```bash
# –í–º–µ—Å—Ç–æ python api/index.py
waitress-serve --host 0.0.0.0 --port 5000 --threads 4 api.index:app
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--threads 4` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2-4 –Ω–∞ CPU core)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Production-ready error handling

---

### **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Gunicorn (Linux/Mac)**

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 api.index:app
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `-w 4` - 4 worker –ø—Ä–æ—Ü–µ—Å—Å–∞
- `-b` - bind address
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows

---

### **Docker + Gunicorn (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)**

```dockerfile
# Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt gunicorn
COPY . .
CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "api.index:app"]
```

---

## –¢–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **Development Server (threaded=True):**

**–ë–µ–∑ AI –≤—ã–∑–æ–≤–æ–≤:**
- ~10-20 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 5-10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–° AI –≤—ã–∑–æ–≤–∞–º–∏ (DeepSeek):**
- ~1-3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ AI latency)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 3-5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ AI –≤—ã–∑–æ–≤—ã (DeepSeek API - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ requests)
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ DB –∑–∞–ø—Ä–æ—Å—ã (Supabase - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ requests)
- –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (10-30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–¥–∏–Ω build-board –∑–∞–ø—Ä–æ—Å)

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### **–¢–µ–∫—É—â–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

1. **AI –≤—ã–∑–æ–≤—ã** (DeepSeek API)
   - –í—Ä–µ–º—è: 2-10 —Å–µ–∫—É–Ω–¥
   - –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ requests.post()
   - –ú–æ–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ ThreadPoolExecutor

2. **Supabase –∑–∞–ø—Ä–æ—Å—ã**
   - –í—Ä–µ–º—è: 100-500ms –∫–∞–∂–¥—ã–π
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ–¥–∏–Ω build-board –∑–∞–ø—Ä–æ—Å
   - –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å batch –∑–∞–ø—Ä–æ—Å–∞–º–∏

3. **Embedding –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** (sentence-transformers)
   - –í—Ä–µ–º—è: 50-200ms
   - –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π model (shared)

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### **1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å production WSGI server**
```bash
# Waitress (–∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π)
waitress-serve --host 0.0.0.0 --port 5000 --threads 8 api.index:app
```

#### **2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å DB –∑–∞–ø—Ä–æ—Å—ã**
- Batch –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Connection pooling

#### **3. Rate limiting**
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö AI –∑–∞–ø—Ä–æ—Å–æ–≤
- Queue –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å 3 –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
curl -X POST http://localhost:5000/api/ai/build-board \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"prompt": "test 1"}' &

curl -X POST http://localhost:5000/api/ai/build-board \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"prompt": "test 2"}' &

curl -X POST http://localhost:5000/api/ai/build-board \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"prompt": "test 3"}' &

wait
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –í—Å–µ 3 –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ï—Å–ª–∏ `threaded=False` - –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

---

## –†–µ–∑—é–º–µ

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ `threaded=True` –¥–æ–±–∞–≤–ª–µ–Ω - **–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**
- ‚ö†Ô∏è Development server - –Ω–µ –¥–ª—è production –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é single process

### **–î–ª—è production:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Waitress –∏–ª–∏ Gunicorn
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤/workers
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è AI endpoints
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–î–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:**
```bash
pip install waitress
waitress-serve --host 0.0.0.0 --port 5000 --threads 8 api.index:app
```

**–í –∫–æ–¥–µ (api/index.py):**
```python
if __name__ == '__main__':
    from waitress import serve
    serve(app, host='0.0.0.0', port=5000, threads=8)
```

